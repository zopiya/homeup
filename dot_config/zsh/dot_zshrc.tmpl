{{- /* ==============================================================================
Zsh Configuration - Profile-Aware

Shell experience is CONSISTENT across all profiles.
Only security modules (GPG, 1Password, YubiKey) differ by profile.
============================================================================== */ -}}
{{- $profile := .profile | default "workstation" -}}
{{- $isWorkstation := eq $profile "workstation" -}}

# ==============================================================================
# Zsh Configuration (Profile: {{ $profile }})
# ==============================================================================

# --- Homebrew Environment ---
if [[ -x /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -x /usr/local/bin/brew ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
elif [[ -x /home/linuxbrew/.linuxbrew/bin/brew ]]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
elif [[ -x "$HOME/.linuxbrew/bin/brew" ]]; then
    eval "$("$HOME/.linuxbrew/bin/brew" shellenv)"
fi

# --- Path ---
export PATH="$HOME/.local/bin:$PATH"

# --- Core Tools (Consistent Across All Profiles) ---

# Sheldon (Plugin Manager)
if command -v sheldon &> /dev/null; then
    eval "$(sheldon source)"
fi

# Initialize Completion System
# Must be initialized after plugins (like zsh-completions) update fpath
autoload -Uz compinit
compinit

# Starship (Prompt)
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

# Zoxide (Smart Directory Jumper)
if command -v zoxide &> /dev/null; then
    eval "$(zoxide init zsh)"
fi

# Mise (Runtime Manager)
if command -v mise &> /dev/null; then
    eval "$(mise activate zsh)"
fi

# FZF (Fuzzy Finder)
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Atuin (Shell History)
if command -v atuin &> /dev/null; then
    eval "$(atuin init zsh)"
fi

# --- Modular Configs ---
[ -f "$ZDOTDIR/exports.zsh" ] && source "$ZDOTDIR/exports.zsh"
[ -f "$ZDOTDIR/aliases.zsh" ] && source "$ZDOTDIR/aliases.zsh"
[ -f "$ZDOTDIR/functions.zsh" ] && source "$ZDOTDIR/functions.zsh"

# --- Security Modules (Profile-Dependent) ---
{{- if $isWorkstation }}
# [Workstation] Full security integration

# GPG Agent
[ -f "$XDG_CONFIG_HOME/security/gpg.inc" ] && source "$XDG_CONFIG_HOME/security/gpg.inc"

# 1Password CLI
[ -f "$XDG_CONFIG_HOME/security/1password.inc" ] && source "$XDG_CONFIG_HOME/security/1password.inc"

# YubiKey
[ -f "$XDG_CONFIG_HOME/security/yubikey.inc" ] && source "$XDG_CONFIG_HOME/security/yubikey.inc"
{{- else }}
# [{{ $profile | title }}] Security modules disabled
# GPG agent not launched, 1Password/YubiKey integration skipped
{{- end }}
