#!/bin/bash

# Purpose: Validate environment before running other scripts
# Runs once when hash changes

set -euo pipefail

{{- template "utils.sh" . -}}

header "Validating Environment"

# Homebrew Configuration
if [[ -x /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -x /usr/local/bin/brew ]]; then
  eval "$(/usr/local/bin/brew shellenv)"
elif [[ -x /home/linuxbrew/.linuxbrew/bin/brew ]]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
elif [[ -x "$HOME/.linuxbrew/bin/brew" ]]; then
  eval "$("$HOME/.linuxbrew/bin/brew" shellenv)"
fi

# Check for internet connection
step 1 2 "Checking internet connection..."
if ! curl -s --head https://google.com > /dev/null; then
    error "No internet connection."
    exit 1
else
    success "Internet connection active"
fi

# Check if Homebrew is installed
step 2 2 "Checking Homebrew..."
if ! command -v brew &> /dev/null; then
    error "Homebrew is not installed."
    exit 1
else
    success "Homebrew is installed"
fi

echo ""
success "Environment validation passed."
