# Troubleshooting and FAQ: Common Issues and Solutions

> Quick diagnosis and resolution guide for Homeup setup, configuration, and daily operations

**ç‰ˆæœ¬**: 2.1
**ç›®æ ‡å—ä¼—**: Homeup ç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜ã€é—®é¢˜æ’æŸ¥è€…
**å‰ç½®çŸ¥è¯†**: Homeup åŸºç¡€æ¦‚å¿µ

---

## ç›®å½•

- [å¿«é€Ÿè¯Šæ–­](#å¿«é€Ÿè¯Šæ–­)
- [å®‰è£…å’Œåˆå§‹åŒ–](#å®‰è£…å’Œåˆå§‹åŒ–)
- [åŒ…ç®¡ç†](#åŒ…ç®¡ç†)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
- [Git å’Œè®¤è¯](#git-å’Œè®¤è¯)
- [ç¼–è¾‘å™¨](#ç¼–è¾‘å™¨)
- [Shell ç¯å¢ƒ](#shell-ç¯å¢ƒ)
- [æ€§èƒ½é—®é¢˜](#æ€§èƒ½é—®é¢˜)
- [å¤šæœºå™¨åŒæ­¥](#å¤šæœºå™¨åŒæ­¥)
- [Mise å’Œ Direnv](#mise-å’Œ-direnv)
- [é«˜çº§æ•…éšœæ’æŸ¥](#é«˜çº§æ•…éšœæ’æŸ¥)
- [å¸¸è§é”™è¯¯å†³ç­–æ ‘](#å¸¸è§é”™è¯¯å†³ç­–æ ‘)

---

## å¿«é€Ÿè¯Šæ–­

### ç¬¬ä¸€æ­¥ï¼šè¿è¡Œå¥åº·æ£€æŸ¥

```bash
# æœ€å¿«çš„è¯Šæ–­æ–¹å¼
just doctor

# å¦‚æœæ²¡æœ‰ just
./justfile doctor

# æˆ–ç›´æ¥è¿è¡Œ Chezmoi æ£€æŸ¥
chezmoi status
```

è¾“å‡ºåº”è¯¥æ˜¾ç¤ºï¼š

```
=== Homeup Health Check ===

Required tools:
  [OK] brew
  [OK] chezmoi
  [OK] git
  [OK] just

Optional tools:
  [OK] zsh
  [OK] starship
  [--] mise (not installed)

All checks passed
```

### å¸¸è§è¯Šæ–­å‘½ä»¤

```bash
# Homebrew çŠ¶æ€
brew doctor
brew outdated

# Chezmoi çŠ¶æ€
chezmoi status
chezmoi diff

# Git çŠ¶æ€
git status
git log --oneline -5

# Shell å¯åŠ¨æ—¶é—´
time zsh -i -c exit

# ç‰ˆæœ¬æ£€æŸ¥
zsh --version
git --version
just --version
chezmoi --version
```

---

## å®‰è£…å’Œåˆå§‹åŒ–

### â“ "brew command not found"

**é—®é¢˜**: Homebrew æœªå®‰è£…æˆ–ä¸åœ¨ PATH ä¸­

**è¯Šæ–­**:

```bash
# æ£€æŸ¥æ˜¯å¦å®‰è£…
which brew

# æ£€æŸ¥è·¯å¾„
echo $PATH

# æŸ¥çœ‹ Homebrew ä½ç½®
ls /opt/homebrew/bin/brew  # macOS
ls /home/linuxbrew/.linuxbrew/bin/brew  # Linux
```

**è§£å†³**:

```bash
# å®‰è£… Homebrew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# æ·»åŠ åˆ° PATHï¼ˆå¦‚æœå®‰è£…åˆ°éæ ‡å‡†ä½ç½®ï¼‰
# æ·»åŠ åˆ° ~/.zshrc:
export PATH="/opt/homebrew/bin:$PATH"

# é‡å¯ Shell
exec zsh -l
```

### â“ "just bootstrap" å¤±è´¥

**é—®é¢˜**: åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ–­

**è¯Šæ–­**:

```bash
# 1. æ£€æŸ¥å‰ç½®æ¡ä»¶
just check

# 2. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
just bootstrap --verbose  # å¦‚æœ just æ”¯æŒ

# 3. é€æ­¥æ‰§è¡Œ
just install-bootstrap
just install-core
just setup
```

**å¸¸è§åŸå› å’Œè§£å†³**:

```bash
# åŸå›  1ï¼šHomebrew æ²¡æœ‰è¶³å¤Ÿæƒé™
# è§£å†³ï¼š
sudo chown -R $(whoami) /opt/homebrew

# åŸå›  2ï¼šç½‘ç»œé—®é¢˜
# è§£å†³ï¼š
brew update
brew install --help  # æµ‹è¯•è¿æ¥

# åŸå›  3ï¼šç£ç›˜ç©ºé—´ä¸è¶³
# è¯Šæ–­ï¼š
df -h

# è§£å†³ï¼š
brew cleanup --prune=all
```

### â“ "chezmoi init" å¤±è´¥

**é—®é¢˜**: Chezmoi åˆå§‹åŒ–å‡ºé”™

**è¯Šæ–­**:

```bash
# 1. æ£€æŸ¥ Homeup ä»“åº“
git status

# 2. æ£€æŸ¥ .chezmoi.toml.tmpl æ˜¯å¦å­˜åœ¨
cat .chezmoi.toml.tmpl

# 3. æŸ¥çœ‹ Chezmoi æ—¥å¿—
:LspLog  # åœ¨ Neovim ä¸­
# æˆ–
chezmoi init --help
```

**è§£å†³**:

```bash
# 1. æ‰‹åŠ¨åˆå§‹åŒ–
chezmoi init --source . --apply

# 2. æˆ–æŒ‡å®š Profile
HOMEUP_PROFILE=macos chezmoi init --source . --apply

# 3. å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯
chezmoi init --source . --dry-run

# 4. æ¸…ç©ºå¹¶é‡è¯•
chezmoi purge --force
chezmoi init --source . --apply
```

---

## åŒ…ç®¡ç†

### â“ "formula not found"

**é—®é¢˜**: `brew install nonexistent-package` å¤±è´¥

**è§£å†³**:

```bash
# 1. æœç´¢æ­£ç¡®çš„åŒ…å
brew search "package-keyword"

# 2. æŸ¥çœ‹åŒ…ä¿¡æ¯
brew info package-name

# 3. æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
brew list | grep package

# 4. æ£€æŸ¥éœ€è¦çš„ Tap
brew tap homebrew/cask
brew install --cask "app-name"
```

### â“ "Permission denied" åœ¨ brew æ“ä½œæ—¶

**é—®é¢˜**: Homebrew æƒé™é—®é¢˜

**è§£å†³**:

```bash
# 1. ä¿®å¤æƒé™
sudo chown -R $(whoami) /opt/homebrew

# 2. æˆ–é‡æ–°å®‰è£…
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 3. æµ‹è¯•
brew list
```

### â“ "Brewfile conflict"

**é—®é¢˜**: `brew bundle` ä¸­æœ‰å†²çªçš„åŒ…

**è¯Šæ–­**:

```bash
# è¿è¡Œ Homeup çš„é‡å¤æ£€æŸ¥
just pkg-duplicates

# è¾“å‡ºåº”è¯¥æ˜¾ç¤ºå†²çªçš„åŒ…
```

**è§£å†³**:

```bash
# 1. æ£€æŸ¥å“ªäº›åŒ…åœ¨ä¸¤ä¸ª Brewfile ä¸­
brew list

# 2. ç§»é™¤é‡å¤
grep "package-name" packages/Brewfile.*

# 3. ä»å…¶ä¸­ä¸€ä¸ª Brewfile ä¸­åˆ é™¤

# 4. é‡è¯•
just install
```

---

## é…ç½®ç®¡ç†

### â“ "chezmoi status" æ˜¾ç¤ºå˜åŒ–ï¼Œä½†æˆ‘æ²¡æœ‰ä¿®æ”¹

**åŸå› **: Chezmoi æ£€æµ‹åˆ°å·®å¼‚

**è¯Šæ–­**:

```bash
# æŸ¥çœ‹å…·ä½“å·®å¼‚
chezmoi diff

# æŸ¥çœ‹æ–‡ä»¶æƒé™é—®é¢˜
ls -la ~/.zshrc
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šæƒé™é—®é¢˜
# ä¿®å¤ï¼š
chezmoi apply

# åŸå›  2ï¼šå®é™…ä¿®æ”¹äº†
# æäº¤ï¼š
chezmoi add ~/.zshrc

# åŸå›  3ï¼šæ¨¡æ¿å˜é‡ä¸åŒ¹é…
# æŸ¥çœ‹ï¼š
chezmoi cat ~/.zshrc

# ä¿®å¤ï¼š
# æ›´æ–° .chezmoi.toml.tmpl ä¸­çš„å˜é‡
```

### â“ "template syntax error"

**é—®é¢˜**: Chezmoi æ¨¡æ¿å‡ºé”™

**è¯Šæ–­**:

```bash
# 1. æŸ¥çœ‹å“ªä¸ªæ–‡ä»¶æœ‰é”™è¯¯
git status

# 2. æ£€æŸ¥æ¨¡æ¿è¯­æ³•
chezmoi execute-template < your-template-file

# 3. è¿è¡ŒéªŒè¯
just validate
```

**è§£å†³**:

```bash
# å¸¸è§é”™è¯¯ 1ï¼šæœªé—­åˆçš„æ‹¬å·
# é”™è¯¯ï¼š{{ .variable }
# æ­£ç¡®ï¼š{{ .variable }}

# å¸¸è§é”™è¯¯ 2ï¼šæ— æ•ˆçš„å˜é‡
# æ£€æŸ¥ï¼š.chezmoi.toml.tmpl ä¸­æ˜¯å¦å®šä¹‰äº†è¯¥å˜é‡

# å¸¸è§é”™è¯¯ 3ï¼šæ¡ä»¶è¯­æ³•é”™è¯¯
# é”™è¯¯ï¼š{{ if .variable }}
# æ­£ç¡®ï¼š{{- if .variable }}ï¼ˆ-å»æ‰ç©ºæ ¼ï¼‰
```

---

## Git å’Œè®¤è¯

### â“ "ssh: connect refused"

**é—®é¢˜**: SSH è¿æ¥å¤±è´¥

**è¯Šæ–­**:

```bash
# 1. æµ‹è¯• GitHub è¿æ¥
ssh -T git@github.com

# 2. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
ssh -v git@github.com

# 3. æ£€æŸ¥ SSH å¯†é’¥
ls -la ~/.ssh/
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šYubiKey æœªåŠ è½½
yk  # åŠ è½½ YubiKey
ssh-add -l  # éªŒè¯

# åŸå›  2ï¼šSSH å¯†é’¥æƒé™
chmod 600 ~/.ssh/main

# åŸå›  3ï¼šSSH é…ç½®é”™è¯¯
cat ~/.ssh/config
# æ£€æŸ¥ IdentityFile æ˜¯å¦æ­£ç¡®

# åŸå›  4ï¼šå…¬é’¥æœªæ·»åŠ åˆ° GitHub
# GitHub â†’ Settings â†’ SSH Keys â†’ æ·»åŠ æ–°å…¬é’¥
cat ~/.ssh/main.pub
```

### â“ "git commit" å¤±è´¥æ—¶å‡ºç° "gpg failed to sign"

**é—®é¢˜**: Git ç­¾åå¤±è´¥

**è¯Šæ–­**:

```bash
# 1. æ£€æŸ¥ Git é…ç½®
git config user.signingkey
git config gpg.format

# 2. æµ‹è¯•ç­¾å
ssh-keygen -Y sign -f ~/.ssh/main <<< "test"

# 3. æ£€æŸ¥ YubiKey
ssh-add -l
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šYubiKey æœªåŠ è½½
yk  # åŠ è½½å¯†é’¥

# åŸå›  2ï¼šç­¾åå¯†é’¥ä¸æ­£ç¡®
git config --global user.signingkey ~/.ssh/main

# åŸå›  3ï¼šSSH ç¨‹åºè·¯å¾„é”™è¯¯
git config --global gpg.ssh.program /usr/bin/ssh-keygen

# åŸå›  4ï¼šallowed_signers æ–‡ä»¶ç¼ºå¤±
cat ~/.ssh/allowed_signers
# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºï¼š
echo "$USER sk-ssh-ed25519@... $(ssh-keygen -y -f ~/.ssh/main)" > ~/.ssh/allowed_signers
```

### â“ "push rejected"

**é—®é¢˜**: æ¨é€è¢«è¿œç¨‹æ‹’ç»

**åŸå› å’Œè§£å†³**:

```bash
# åŸå›  1ï¼šè¿œç¨‹æœ‰ä½ æ²¡æœ‰çš„æäº¤
# è§£å†³ï¼š
git pull --rebase
git push

# åŸå›  2ï¼šè¢«ä¿æŠ¤çš„åˆ†æ”¯ï¼ˆmainï¼‰
# è§£å†³ï¼š
git checkout -b feature-branch
git push origin feature-branch
# åˆ›å»º Pull Request

# åŸå›  3ï¼šæƒé™ä¸è¶³
# æ£€æŸ¥ï¼šGitHub repository â†’ Collaborators
# æˆ–é—®ä¸»ç®¡æ·»åŠ ä½ çš„è®¿é—®æƒé™
```

---

## ç¼–è¾‘å™¨

### â“ "Neovim won't open"

**é—®é¢˜**: `nvim` å‘½ä»¤æ— æ³•å¯åŠ¨

**è¯Šæ–­**:

```bash
# 1. æ£€æŸ¥æ˜¯å¦å®‰è£…
which nvim
nvim --version

# 2. æ£€æŸ¥é…ç½®
ls ~/.config/nvim/

# 3. æµ‹è¯•å¯åŠ¨
nvim -u NONE  # ä¸åŠ è½½é…ç½®
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šNeovim æœªå®‰è£…
brew install neovim

# åŸå›  2ï¼šé…ç½®æœ‰è¯­æ³•é”™è¯¯
# æ£€æŸ¥ï¼š
chezmoi apply  # é‡æ–°åº”ç”¨é…ç½®

# åŸå›  3ï¼šæ’ä»¶å†²çª
# å¯åŠ¨æ— é…ç½® Neovimï¼š
nvim -u NONE

# ç„¶åæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„é”™è¯¯
```

### â“ "LSP not working"

**é—®é¢˜**: LSP åŠŸèƒ½ä¸å¯ç”¨

**è¯Šæ–­**:

```bash
# åœ¨ Neovim ä¸­ï¼š
:LspInfo

# åº”è¯¥æ˜¾ç¤ºè¿è¡Œçš„è¯­è¨€æœåŠ¡å™¨
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šè¯­è¨€æœåŠ¡å™¨æœªå®‰è£…
:MasonInstall pyright

# åŸå›  2ï¼šè¯­è¨€æœåŠ¡å™¨è¿›ç¨‹æ— å“åº”
:LspRestart

# åŸå›  3ï¼šé…ç½®é”™è¯¯
# æ£€æŸ¥ï¼š
cat ~/.config/nvim/lua/config/lsp.lua

# é‡å¯ Neovimï¼š
:q
nvim
```

---

## Shell ç¯å¢ƒ

### â“ "zsh: command not found"

**é—®é¢˜**: å‘½ä»¤æ‰¾ä¸åˆ°

**è¯Šæ–­**:

```bash
# 1. æ£€æŸ¥ command æ˜¯å¦å®‰è£…
which command
brew list | grep command

# 2. æ£€æŸ¥ PATH
echo $PATH

# 3. æ£€æŸ¥ Shell é…ç½®
cat ~/.zshrc
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šåŒ…æœªå®‰è£…
brew install command

# åŸå›  2ï¼šPATH é…ç½®é”™è¯¯
# æ·»åŠ åˆ° ~/.zshrcï¼š
export PATH="/opt/homebrew/bin:$PATH"

# åŸå›  3ï¼šShell é…ç½®å†²çª
# æ£€æŸ¥é‡å¤å®šä¹‰æˆ–å†²çªçš„åˆ«åï¼š
grep "alias command" ~/.zshrc ~/.config/zsh/*

# åˆ é™¤å†²çªå¹¶é‡å¯ï¼š
exec zsh -l
```

### â“ "Shell å¯åŠ¨ç¼“æ…¢"

**é—®é¢˜**: Zsh åˆå§‹åŒ–è€—æ—¶å¤ªé•¿

**è¯Šæ–­**:

```bash
# æµ‹è¯•å¯åŠ¨æ—¶é—´
time zsh -i -c exit

# åº”è¯¥ <100ms

# æŸ¥æ‰¾æ…¢çš„åˆå§‹åŒ–ä»£ç 
zsh -x  # å¯ç”¨è·Ÿè¸ª
# é€è¡Œè¾“å‡ºæ¯ä¸ªå‘½ä»¤å’Œè€—æ—¶
Ctrl+C  # åœæ­¢
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šæ’ä»¶è¿‡å¤š
# ç§»é™¤ä¸å¿…è¦çš„ Sheldon æ’ä»¶
nvim ~/.config/sheldon/plugins.toml

# åŸå›  2ï¼šåˆå§‹åŒ–ä»£ç å†—é•¿
# ç®€åŒ– ~/.zshrc
# ç§»é™¤è°ƒè¯•ä»£ç ã€ä¸å¿…è¦çš„å‘½ä»¤

# åŸå›  3ï¼šMise åˆå§‹åŒ–ç¼“æ…¢
# ä¼˜åŒ–ï¼š
eval "$(mise activate zsh)"
# è€Œä¸æ˜¯å¤šæ¬¡è°ƒç”¨ mise
```

---

## æ€§èƒ½é—®é¢˜

### â“ "Chezmoi apply å¾ˆæ…¢"

**é—®é¢˜**: åº”ç”¨é…ç½®è€—æ—¶

**è¯Šæ–­**:

```bash
# æµ‹è¯•é€Ÿåº¦
time chezmoi apply

# åº”è¯¥ <5 ç§’
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šæ–‡ä»¶å¤ªå¤š
# æ£€æŸ¥æœ‰å¤šå°‘æ–‡ä»¶è¢«ç®¡ç†ï¼š
chezmoi list | wc -l

# åŸå›  2ï¼šç½‘ç»œé—®é¢˜
# å¦‚æœä½¿ç”¨ Git SSHï¼š
git fetch

# åŸå›  3ï¼šç£ç›˜æ€§èƒ½
# æ£€æŸ¥ç£ç›˜ I/Oï¼š
diskutil info /
```

### â“ "Just å‘½ä»¤æ‰§è¡Œç¼“æ…¢"

**é—®é¢˜**: `just` ä»»åŠ¡è€—æ—¶è¿‡é•¿

**è§£å†³**:

```bash
# åŸå›  1ï¼šå¹¶è¡Œä»»åŠ¡é…ç½®
# æ£€æŸ¥ justfile ä¸­æ˜¯å¦ä½¿ç”¨ &&
# æ”¹ç”¨ &ï¼š
command1 &
command2 &
wait

# åŸå›  2ï¼šBrew æ“ä½œç¼“æ…¢
# æ›´æ–°ç¼“å­˜ï¼š
brew update

# åŸå›  3ï¼šChezmoi é›†æˆ
# æ£€æŸ¥ chezmoi apply çš„æ€§èƒ½
time chezmoi apply
```

---

## å¤šæœºå™¨åŒæ­¥

### â“ "Pull æ—¶å‡ºç°å†²çª"

**é—®é¢˜**: `git pull` åæœ‰åˆå¹¶å†²çª

**è¯Šæ–­**:

```bash
# æŸ¥çœ‹å†²çªæ–‡ä»¶
git status

# æŸ¥çœ‹å…·ä½“å†²çª
git diff
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šåŒæ—¶ä¿®æ”¹äº†åŒä¸€æ–‡ä»¶
# æ‰‹åŠ¨è§£å†³å†²çªï¼š
nvim conflicted-file

# åˆ é™¤å†²çªæ ‡è®°ï¼Œä¿ç•™éœ€è¦çš„å†…å®¹
# <<<<<< HEAD
# your changes
# ======
# incoming changes
# >>>>>>

# 2. æäº¤è§£å†³
git add conflicted-file
git commit -m "fix: merge conflict"

# åŸå›  2ï¼šBrewfile å†²çª
# è§£å†³ï¼š
just pkg-duplicates  # æ£€æŸ¥é‡å¤åŒ…
# ç§»é™¤é‡å¤ï¼Œä¿ç•™ä¸¤è¾¹çš„æ›´æ”¹
```

### â“ "æ–°æœºå™¨æ— æ³• Clone Homeup ä»“åº“"

**é—®é¢˜**: SSH è®¤è¯å¤±è´¥

**è¯Šæ–­**:

```bash
# 1. æµ‹è¯• SSH
ssh -T git@github.com

# 2. æµ‹è¯• clone
git clone git@github.com:username/homeup.git

# 3. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
# é€šå¸¸ä¼šæ˜¾ç¤ºæƒé™æˆ–ç½‘ç»œé—®é¢˜
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šSSH å¯†é’¥æœªè®¾ç½®
# ç”Ÿæˆå¯†é’¥ï¼š
ssh-keygen -t ed25519 -C "user@example.com"

# åŸå›  2ï¼šSSH å¯†é’¥æœªæ·»åŠ åˆ° GitHub
# å¤åˆ¶å…¬é’¥ï¼š
cat ~/.ssh/id_ed25519.pub
# GitHub â†’ Settings â†’ SSH Keys â†’ New SSH Key

# åŸå›  3ï¼šYubiKey æœªåŠ è½½
yk
ssh-add -l  # éªŒè¯

# åŸå›  4ï¼šç½‘ç»œé—®é¢˜
# æ£€æŸ¥è¿æ¥ï¼š
ping github.com

# ä½¿ç”¨ HTTPS ä½œä¸ºå¤‡é€‰ï¼š
git clone https://github.com/username/homeup.git
```

---

## å¿«é€Ÿå‚è€ƒ

### å¸¸è§å‘½ä»¤é€ŸæŸ¥

```bash
# è¯Šæ–­å’Œä¿®å¤
just doctor          # å¥åº·æ£€æŸ¥
just validate-all    # å¿«é€ŸéªŒè¯
chezmoi diff         # æŸ¥çœ‹å¾…åº”ç”¨çš„æ›´æ”¹
chezmoi apply        # åº”ç”¨é…ç½®

# é—®é¢˜æ’æŸ¥
git status           # çœ‹å·¥ä½œçŠ¶æ€
git log --oneline    # çœ‹æäº¤å†å²
zsh --version        # çœ‹ shell ç‰ˆæœ¬
just --version       # çœ‹ just ç‰ˆæœ¬

# ç´§æ€¥ä¿®å¤
just rescue          # ç´§æ€¥ä¿®å¤
chezmoi purge --force # æ¸…é™¤æ‰€æœ‰ Chezmoi çŠ¶æ€
brew cleanup         # æ¸…é™¤ Brew ç¼“å­˜
```

---

## ä½•æ—¶å¯»æ±‚å¸®åŠ©

### æ”¶é›†è°ƒè¯•ä¿¡æ¯

åœ¨æŠ¥å‘Šé—®é¢˜æ—¶ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

```bash
# ç³»ç»Ÿä¿¡æ¯
uname -a
arch

# å·¥å…·ç‰ˆæœ¬
zsh --version
git --version
just --version
chezmoi --version
brew --version

# é”™è¯¯æ—¥å¿—
# è¿è¡Œå¤±è´¥çš„å‘½ä»¤å¹¶å¤åˆ¶è¾“å‡º

# é…ç½®æ£€æŸ¥
chezmoi status
git status
just doctor

# å¦‚æœæ¶‰åŠ LSP
:LspInfo        # åœ¨ Neovim ä¸­
```

---

## Mise å’Œ Direnv

### â“ "direnv: command not found"

**é—®é¢˜**: Direnv æœªå®‰è£…æˆ–æ— æ³•æ‰¾åˆ°

**è§£å†³**:

```bash
# 1. å®‰è£…
brew install direnv

# 2. åˆå§‹åŒ–åˆ° Shell
# æ·»åŠ åˆ° ~/.zshrcï¼š
eval "$(direnv hook zsh)"

# 3. é‡å¯ Shell
exec zsh -l
```

### â“ ".envrc ä¸è‡ªåŠ¨åŠ è½½"

**é—®é¢˜**: åˆ‡æ¢ç›®å½•åç¯å¢ƒå˜é‡æœªåŠ è½½

**è¯Šæ–­**:

```bash
# æ£€æŸ¥ direnv çŠ¶æ€
direnv status

# æŸ¥çœ‹æœ¬ç›®å½•çš„ .envrc
cat .envrc

# æ£€æŸ¥æ˜¯å¦è¢«å…è®¸
direnv allow  # æˆ– direnv deny
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šéœ€è¦æ˜ç¡®å…è®¸
direnv allow

# åŸå›  2ï¼š.envrc è¯­æ³•é”™è¯¯
# ç¼–è¾‘å¹¶ä¿®å¤ï¼š
direnv edit

# åŸå›  3ï¼šDirenv Hook æœªåŠ è½½
# æ£€æŸ¥ ~/.zshrc æ˜¯å¦æœ‰ï¼š
eval "$(direnv hook zsh)"

# åŸå›  4ï¼šç¼“å­˜é—®é¢˜
direnv reload
```

### â“ "mise install å¾ˆæ…¢"

**é—®é¢˜**: å®‰è£…å·¥å…·ç‰ˆæœ¬è€—æ—¶å¤ªé•¿

**è¯Šæ–­**:

```bash
# æŸ¥çœ‹æ­£åœ¨ä¸‹è½½å“ªä¸ªå·¥å…·
mise install -v

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping github.com
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šç½‘ç»œæ…¢
# ç­‰å¾…æˆ–æ£€æŸ¥ç½‘ç»œ

# åŸå›  2ï¼šç¼“å­˜æœªæ­£ç¡®ä½¿ç”¨
mise cache clean
mise install

# åŸå›  3ï¼šå¤šä¸ªå·¥å…·å¹¶è¡Œå®‰è£…å†²çª
# é€ä¸ªå®‰è£…ï¼š
mise install python
mise install node
```

### â“ "mise ç‰ˆæœ¬å†²çª"

**é—®é¢˜**: åŒæ—¶æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå¯¼è‡´ PATH æ··ä¹±

**è¯Šæ–­**:

```bash
# æ£€æŸ¥å®‰è£…çš„ç‰ˆæœ¬
mise list

# æŸ¥çœ‹å½“å‰æ¿€æ´»çš„ç‰ˆæœ¬
which node
node --version

# æŸ¥çœ‹ PATH
echo $PATH
```

**è§£å†³**:

```bash
# åŸå›  1ï¼šç³»ç»Ÿä¸­è¿˜æœ‰å…¶ä»–åŒ…ç®¡ç†çš„ç‰ˆæœ¬
# å¸è½½ç³»ç»ŸåŒ…ï¼š
brew uninstall node  # ç§»é™¤ç³»ç»Ÿçš„ node
mise install        # é‡æ–°å®‰è£…

# åŸå›  2ï¼š.mise.toml ä¸­å®šä¹‰äº†é”™è¯¯çš„ç‰ˆæœ¬
cat .mise.toml
# æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦æœ‰æ•ˆ

# åŸå›  3ï¼šDirenv æœªæ­£ç¡®åŠ è½½
direnv allow
direnv reload
```

---

## é«˜çº§æ•…éšœæ’æŸ¥

### ğŸ” å¦‚ä½•åˆ›å»ºå®Œæ•´çš„è¯Šæ–­æŠ¥å‘Š

å½“æŠ¥å‘Šé—®é¢˜æ—¶ï¼Œæ”¶é›†ä»¥ä¸‹å®Œæ•´ä¿¡æ¯ï¼š

```bash
#!/bin/bash
# ä¿å­˜ä¸º diagnose.shï¼Œè¿è¡Œï¼šbash diagnose.sh

echo "=== System Information ==="
uname -a
arch
sw_vers  # macOS

echo ""
echo "=== Tool Versions ==="
zsh --version
bash --version
git --version
just --version
chezmoi --version
brew --version
node --version 2>/dev/null || echo "Node: not installed"
python --version 2>/dev/null || echo "Python: not installed"

echo ""
echo "=== Critical Paths ==="
echo "Homebrew: $(which brew)"
echo "Chezmoi: $(which chezmoi)"
echo "Just: $(which just)"

echo ""
echo "=== Shell Configuration ==="
echo "SHELL: $SHELL"
echo "ZDOTDIR: $ZDOTDIR"
echo "PATH: $PATH"

echo ""
echo "=== Homeup Status ==="
cd ~/homeup  # æˆ–æ‚¨çš„è·¯å¾„
git status
git log --oneline -5

echo ""
echo "=== Chezmoi Status ==="
chezmoi status 2>/dev/null || echo "Error getting Chezmoi status"

echo ""
echo "=== Health Check ==="
just doctor 2>/dev/null || echo "just doctor failed"
```

### ğŸ” è°ƒè¯•æ¨¡å¼å¯ç”¨

**Shell è°ƒè¯•**:

```bash
# é€è¡Œæ˜¾ç¤ºæ‰§è¡Œçš„å‘½ä»¤
bash -x ~/.zshrc

# å¯ç”¨æ›´è¯¦ç»†çš„è·Ÿè¸ª
set -x
# ... your commands ...
set +x
```

**Chezmoi è°ƒè¯•**:

```bash
# æŸ¥çœ‹ Chezmoi æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œ
chezmoi apply --dry-run

# æŸ¥çœ‹è¯¦ç»†çš„åº”ç”¨æ—¥å¿—
chezmoi apply -vv
```

**Homebrew è°ƒè¯•**:

```bash
# è¯¦ç»†è¾“å‡º
brew install package --verbose

# è¯Šæ–­
brew doctor
brew gist-logs package  # åˆ†äº«æ—¥å¿—
```

### ğŸ”— æ—¥å¿—æ–‡ä»¶ä½ç½®

```bash
# Shell å¯åŠ¨æ—¥å¿—
~/.zsh_history       # Zsh å‘½ä»¤å†å²
~/.bash_history      # Bash å‘½ä»¤å†å²

# Homebrew æ—¥å¿—
~/Library/Logs/Homebrew/  # macOS
~/.cache/Homebrew/Logs/   # Linux

# Chezmoi æ—¥å¿—
~/.local/share/chezmoi/   # æºä»“åº“

# Neovim æ—¥å¿—
:messages            # åœ¨ Neovim ä¸­æŸ¥çœ‹æ¶ˆæ¯
~/.local/share/nvim/log/lsp.log  # LSP æ—¥å¿—
```

### ğŸ”„ ç¡¬é‡ç½®å’Œæ¢å¤

```bash
# æœ€åçš„æ‰‹æ®µï¼šå®Œå…¨é‡ç½®

# 1. å¤‡ä»½é‡è¦æ–‡ä»¶
cp -r ~/.config ~/.config.backup

# 2. æ¸…é™¤ Chezmoi çŠ¶æ€
chezmoi purge --force

# 3. æ¸…é™¤ Homeup ç¼“å­˜
rm -rf ~/.local/share/chezmoi/

# 4. é‡æ–°åˆå§‹åŒ–
cd ~/homeup
chezmoi init --source . --apply

# 5. é‡æ–°åº”ç”¨
just bootstrap
```

---

## å¸¸è§é”™è¯¯å†³ç­–æ ‘

### é—®é¢˜ï¼šHomeup Bootstrap å¤±è´¥

```
â†“ è¿è¡Œ just bootstrap
â”œâ”€ ç«‹å³å¤±è´¥ï¼Ÿ
â”‚  â”œâ”€ æ£€æŸ¥ brew doctor
â”‚  â”œâ”€ æ£€æŸ¥ç£ç›˜ç©ºé—´: df -h
â”‚  â””â”€ æ£€æŸ¥ç½‘ç»œ: ping github.com
â”‚
â”œâ”€ Homebrew å®‰è£…åŒ…æ—¶å¤±è´¥ï¼Ÿ
â”‚  â”œâ”€ æŸä¸ªç‰¹å®šåŒ…ï¼Ÿ
â”‚  â”‚  â””â”€ brew search <package>
â”‚  â”‚  â””â”€ brew install <package> --verbose
â”‚  â””â”€ æ‰€æœ‰åŒ…ï¼Ÿ
â”‚     â””â”€ brew cleanup --prune=all
â”‚     â””â”€ brew update
â”‚
â”œâ”€ Chezmoi åº”ç”¨å¤±è´¥ï¼Ÿ
â”‚  â”œâ”€ æƒé™é”™è¯¯ï¼Ÿ
â”‚  â”‚  â””â”€ chezmoi status
â”‚  â”‚  â””â”€ ls -la ~/.config/
â”‚  â””â”€ æ¨¡æ¿é”™è¯¯ï¼Ÿ
â”‚     â””â”€ chezmoi apply --dry-run
â”‚
â””â”€ Just ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Ÿ
   â””â”€ just <task> --verbose (if supported)
   â””â”€ bash -x ~/.zshrc
```

### é—®é¢˜ï¼šGit/SSH è®¤è¯å¤±è´¥

```
â†“ git æ“ä½œå¤±è´¥æˆ– ssh-add/YubiKey é—®é¢˜
â”œâ”€ YubiKey ç›¸å…³ï¼Ÿ
â”‚  â”œâ”€ yk åŠ è½½å¤±è´¥ï¼Ÿ
â”‚  â”‚  â””â”€ sudo dmesg | grep -i usb
â”‚  â”‚  â””â”€ æ£€æŸ¥ YubiKey æ˜¯å¦è¢«è¯†åˆ«
â”‚  â””â”€ ssh-add å¤±è´¥ï¼Ÿ
â”‚     â””â”€ ssh-add -L  # åˆ—å‡ºå·²åŠ è½½çš„å¯†é’¥
â”‚     â””â”€ yk        # é‡æ–°åˆå§‹åŒ–
â”‚
â”œâ”€ SSH å¯†é’¥é—®é¢˜ï¼Ÿ
â”‚  â”œâ”€ å¯†é’¥ä¸å­˜åœ¨ï¼Ÿ
â”‚  â”‚  â””â”€ ssh-keygen -t ed25519 -C "..."
â”‚  â”œâ”€ æƒé™é”™è¯¯ï¼Ÿ
â”‚  â”‚  â””â”€ chmod 600 ~/.ssh/id_*
â”‚  â””â”€ é…ç½®é”™è¯¯ï¼Ÿ
â”‚     â””â”€ cat ~/.ssh/config
â”‚     â””â”€ ssh -v git@github.com (è°ƒè¯•)
â”‚
â””â”€ GitHub ä¾§é¢é—®é¢˜ï¼Ÿ
   â””â”€ å…¬é’¥æœªæ·»åŠ åˆ° GitHub
   â””â”€ GitHub SSH Key å·²è¿‡æœŸ
   â””â”€ ä»“åº“è®¿é—®æƒé™ä¸è¶³
```

### é—®é¢˜ï¼šé…ç½®æœªåŒæ­¥

```
â†“ chezmoi status æ˜¾ç¤ºå·®å¼‚ä½†æˆ‘æ²¡æ”¹
â”œâ”€ æƒé™é—®é¢˜ï¼Ÿ
â”‚  â”œâ”€ ls -la ~/.zshrc
â”‚  â”œâ”€ chmod 644 ~/.zshrc
â”‚  â””â”€ chezmoi apply
â”‚
â”œâ”€ æ–‡ä»¶å†…å®¹å®é™…å˜åŒ–ï¼Ÿ
â”‚  â”œâ”€ chezmoi diff
â”‚  â”œâ”€ chezmoi add ~/.zshrc
â”‚  â””â”€ git commit
â”‚
â”œâ”€ æ¨¡æ¿å˜é‡å˜åŒ–ï¼Ÿ
â”‚  â”œâ”€ chezmoi execute-template < ~/.zshrc.tmpl
â”‚  â””â”€ æ£€æŸ¥ .chezmoi.toml å˜é‡
â”‚
â””â”€ ç¼“å­˜é—®é¢˜ï¼Ÿ
   â””â”€ chezmoi reload
   â””â”€ chezmoi apply
```

### é—®é¢˜ï¼šæ€§èƒ½å¾ˆå·®

```
â†“ ç³»ç»Ÿå“åº”ç¼“æ…¢
â”œâ”€ Zsh å¯åŠ¨å¾ˆæ…¢ï¼Ÿ
â”‚  â”œâ”€ time zsh -i -c exit
â”‚  â”œâ”€ zsh -x (æ‰¾å‡ºæ…¢çš„éƒ¨åˆ†)
â”‚  â””â”€ å‡å°‘ Sheldon æ’ä»¶
â”‚
â”œâ”€ Neovim å¯åŠ¨å¾ˆæ…¢ï¼Ÿ
â”‚  â”œâ”€ nvim --startuptime /tmp/startup.log
â”‚  â”œâ”€ nvim -u NONE (æ— é…ç½®æµ‹è¯•)
â”‚  â””â”€ ç¦ç”¨é‡æ’ä»¶
â”‚
â”œâ”€ ç£ç›˜ I/O ç¼“æ…¢ï¼Ÿ
â”‚  â”œâ”€ iostat (macOS: `istats`)
â”‚  â””â”€ å…³é—­åå°ä»»åŠ¡
â”‚
â””â”€ å†…å­˜ä¸è¶³ï¼Ÿ
   â”œâ”€ free -h (Linux) æˆ– vm_stat (macOS)
   â””â”€ å…³é—­å…¶ä»–åº”ç”¨
```

---

## å‚è€ƒèµ„æº

- [Homeup GitHub Issues](https://github.com/yourusername/homeup/issues)
- [Chezmoi æ•…éšœæ’æŸ¥](https://www.chezmoi.io/reference/troubleshooting/)
- [Homebrew å¸¸è§é—®é¢˜](https://docs.brew.sh/Troubleshooting)
- [Just GitHub Issues](https://github.com/casey/just/issues)
- [Zsh FAQ](http://zsh.sourceforge.net/FAQ/)
- [Direnv æ–‡æ¡£](https://direnv.net/)
- [Mise æ–‡æ¡£](https://mise.jdx.dev/)
