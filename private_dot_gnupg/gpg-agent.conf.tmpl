{{- /* ==============================================================================
GPG Agent Configuration - Profile Universal

Purpose:
  - Handle GPG key passphrases and caching
  - Provide pinentry for GPG operations
  - Universal across all profiles (macos/linux/mini)

Important Notes:
  - Git signing: Handled by SSH, not GPG (see ~/.config/git/config)
  - GPG usage: General encryption/decryption, file signing
  - Agent restart: gpgconf --kill gpg-agent (auto-restarts on next use)

============================================================================== */ -}}

# ==============================================================================
# GPG Agent Configuration
# Profile: Universal (all profiles use same config)
# ==============================================================================

# --- Cache Settings ---
# Cache GPG passphrases for convenience vs security balance
# Default: 1 hour, Max: 24 hours
default-cache-ttl 3600
max-cache-ttl 86400

# --- Compatibility ---
# Allow pinentry through loopback for non-interactive environments
# Essential for: VS Code GPG extensions, automated scripts, SSH sessions
allow-loopback-pinentry

# --- Pinentry Program Selection ---
# Pinentry handles passphrase prompts (GUI or terminal-based)
{{- if eq .chezmoi.os "darwin" }}
# macOS: Use pinentry-mac for native integration
{{-   if eq .chezmoi.arch "arm64" }}
# Apple Silicon (M1/M2/M3)
pinentry-program /opt/homebrew/bin/pinentry-mac
{{-   else }}
# Intel Mac
pinentry-program /usr/local/bin/pinentry-mac
{{-   end }}
# Install: brew install pinentry-mac
{{- else if eq .chezmoi.os "linux" }}
# Linux: Priority order: Homebrew > System package
{{-   if stat "/home/linuxbrew/.linuxbrew/bin/pinentry" }}
# Homebrew (multi-user installation)
pinentry-program /home/linuxbrew/.linuxbrew/bin/pinentry
{{-   else if stat (printf "%s/.linuxbrew/bin/pinentry" .chezmoi.homeDir) }}
# Homebrew (user installation)
pinentry-program {{ .chezmoi.homeDir }}/.linuxbrew/bin/pinentry
{{-   else }}
# System package (fallback)
pinentry-program /usr/bin/pinentry
{{-   end }}
# Install: brew install pinentry OR apt/dnf install pinentry-gtk2
{{- end }}

# --- Security Options ---
# Uncomment for additional security (requires passphrase more frequently)
# default-cache-ttl 600
# max-cache-ttl 7200
