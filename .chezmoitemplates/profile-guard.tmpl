{{- /*
  profile-guard.tmpl - Reusable profile validation and helper definitions

  Usage in templates:
    {{- template "profile-guard" . -}}

  After including, these variables are available:
    - $profile:      Current profile ("workstation", "codespace", or "server")
    - $isWorkstation: true if profile == "workstation"
    - $isCodespace:   true if profile == "codespace"
    - $isServer:      true if profile == "server"
    - $hasGUI:        true if GUI apps are expected (workstation only)
    - $hasGPG:        true if GPG signing is enabled (workstation only)
    - $hasPrivateKey: true if private keys are available (workstation only)

  Example:
    {{- template "profile-guard" . -}}
    {{- if $isWorkstation }}
    # Workstation-specific configuration
    {{- end }}
*/ -}}

{{- /* Validate and normalize profile */ -}}
{{- $profile := .profile | default "workstation" -}}
{{- $validProfiles := list "workstation" "codespace" "server" -}}
{{- if not (has $profile $validProfiles) -}}
{{-   $profile = "workstation" -}}
{{- end -}}

{{- /* Derived boolean flags */ -}}
{{- $isWorkstation := eq $profile "workstation" -}}
{{- $isCodespace := eq $profile "codespace" -}}
{{- $isServer := eq $profile "server" -}}

{{- /* Capability flags based on profile */ -}}
{{- $hasGUI := $isWorkstation -}}
{{- $hasGPG := $isWorkstation -}}
{{- $hasPrivateKey := $isWorkstation -}}
{{- $hasAgentForward := or $isWorkstation $isCodespace -}}
